<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†åå° - æˆ‘çš„ç½‘ç«™</title>
    <link rel="stylesheet" href="css/admin.css">
    <link rel="stylesheet" href="css/components.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>
<body>
    <!-- å¸®åŠ©æŒ‰é’® -->
    <button class="help-btn" onclick="showHelp()">?</button>
    
    <!-- å¸®åŠ©è¯´æ˜å¼¹çª— -->
    <div class="help-modal" id="helpModal">
        <div class="help-content">
            <button class="close-help" onclick="hideHelp()">&times;</button>
            <h3>ç®¡ç†ç³»ç»Ÿè¯´æ˜</h3>
            
            <div class="role-section">
                <h4>ä¸»ç³»ç»Ÿ (admin)</h4>
                <ul class="permission-list">
                    <li>å¯ä»¥ç®¡ç†æ‰€æœ‰ç•™è¨€ï¼ˆæŸ¥çœ‹ã€åˆ é™¤ï¼‰</li>
                    <li>å¯ä»¥ç®¡ç†è´¦å·ï¼ˆæ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤å…¶ä»–ç®¡ç†å‘˜ï¼‰</li>
                    <li>å¯ä»¥è¿›è¡Œç³»ç»Ÿè®¾ç½®</li>
                    <li>å¯ä»¥è®¿é—®æ‰€æœ‰åŠŸèƒ½æ¨¡å—</li>
                </ul>
            </div>
            
            <div class="role-section">
                <h4>ç®¡ç†å‘˜ (manager)</h4>
                <ul class="permission-list">
                    <li>å¯ä»¥ç®¡ç†ç•™è¨€ï¼ˆæŸ¥çœ‹ã€åˆ é™¤ï¼‰</li>
                    <li>å¯ä»¥è¿›è¡Œç³»ç»Ÿè®¾ç½®</li>
                    <li>ä¸èƒ½ç®¡ç†å…¶ä»–è´¦å·</li>
                    <li>å¯ä»¥è®¿é—®ç•™è¨€ç®¡ç†å’Œç³»ç»Ÿè®¾ç½®</li>
                </ul>
            </div>
            
            <div class="role-section">
                <h4>ç¼–è¾‘ (editor)</h4>
                <ul class="permission-list">
                    <li>åªèƒ½æŸ¥çœ‹ç•™è¨€</li>
                    <li>ä¸èƒ½åˆ é™¤ç•™è¨€</li>
                    <li>ä¸èƒ½ç®¡ç†è´¦å·</li>
                    <li>ä¸èƒ½ä¿®æ”¹ç³»ç»Ÿè®¾ç½®</li>
                    <li>åªèƒ½è®¿é—®ç•™è¨€ç®¡ç†æ¨¡å—</li>
                </ul>
            </div>
            
            <div class="module-section">
                <h4>åŠŸèƒ½æ¨¡å—è¯´æ˜</h4>
                <div class="role-section">
                    <h4>ç•™è¨€ç®¡ç†</h4>
                    <ul class="permission-list">
                        <li>æŸ¥çœ‹æ‰€æœ‰ç•™è¨€</li>
                        <li>æœç´¢ç•™è¨€</li>
                        <li>æŒ‰æ—¶é—´ç­›é€‰ï¼ˆä»Šå¤©/æœ¬å‘¨/æœ¬æœˆï¼‰</li>
                        <li>åˆ é™¤ç•™è¨€ï¼ˆéœ€è¦ç›¸åº”æƒé™ï¼‰</li>
                        <li>å±è”½ç”¨æˆ·ï¼ˆéœ€è¦ç›¸åº”æƒé™ï¼‰</li>
                    </ul>
                </div>
                
                <div class="role-section">
                    <h4>è´¦å·ç®¡ç†ï¼ˆä»…ä¸»ç³»ç»Ÿå¯ç”¨ï¼‰</h4>
                    <ul class="permission-list">
                        <li>æŸ¥çœ‹æ‰€æœ‰ç®¡ç†å‘˜è´¦å·</li>
                        <li>æ·»åŠ æ–°ç®¡ç†å‘˜</li>
                        <li>ç¼–è¾‘ç°æœ‰ç®¡ç†å‘˜</li>
                        <li>åˆ é™¤ç®¡ç†å‘˜</li>
                    </ul>
                </div>
                
                <div class="role-section">
                    <h4>ç³»ç»Ÿè®¾ç½®ï¼ˆä¸»ç³»ç»Ÿå’Œç®¡ç†å‘˜å¯ç”¨ï¼‰</h4>
                    <ul class="permission-list">
                        <li>ç•™è¨€å®¡æ ¸å¼€å…³</li>
                        <li>è®¾ç½®ç•™è¨€é—´éš”æ—¶é—´</li>
                        <li>è®¾ç½®æ¯é¡µæ˜¾ç¤ºæ•°é‡</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- åœ¨bodyæ ‡ç­¾å†…æ·»åŠ éšè—çš„ç®¡ç†å‘˜ä¿¡æ¯å¼¹çª— -->
    <div class="secret-modal" id="secretModal" style="display: none;">
        <div class="help-content">
            <button class="close-help" onclick="hideSecretPanel()">&times;</button>
            <h3>ç³»ç»Ÿè´¦å·ä¿¡æ¯</h3>
            <div id="secretContent"></div>
        </div>
    </div>

    <main>
        <section class="admin-login">
            <div class="login-form">
                <h2>ç®¡ç†å‘˜ç™»å½•</h2>
                <div id="loginError" style="display: none;" class="error-message"></div>
                <form id="loginForm" autocomplete="off">
                    <div class="form-group">
                        <label for="username">ç®¡ç†å‘˜è´¦å·</label>
                        <input type="text" id="username" autocomplete="off" required>
                    </div>
                    <div class="form-group">
                        <label for="password">ç®¡ç†å‘˜å¯†ç </label>
                        <input type="password" id="password" autocomplete="off" required>
                    </div>
                    <button type="submit" class="submit-btn">ç™»å½•</button>
                </form>
            </div>
        </section>

        <section class="admin-panel" style="display: none;">
            <div class="admin-sidebar">
                <div class="admin-info">
                    <strong>ç®¡ç†å‘˜ä¿¡æ¯</strong>
                    <span id="adminInfo"></span>
                </div>
                <button id="toggleNav" class="toggle-nav">
                    <span class="toggle-icon">â–²</span>
                </button>
                <nav class="admin-nav">
                    <button class="nav-btn active" onclick="switchPanel('message')">ç•™è¨€ç®¡ç†</button>
                    <button class="nav-btn" onclick="switchPanel('account')">è´¦å·ç®¡ç†</button>
                    <button class="nav-btn" onclick="switchPanel('system')">ç³»ç»Ÿè®¾ç½®</button>
                    <button class="logout-btn" onclick="logout()">é€€å‡ºç™»å½•</button>
                </nav>
            </div>
            
            <div class="admin-content">
                <!-- ç•™è¨€ç®¡ç†é¢æ¿ -->
                <div id="messagePanel" class="panel active">
                    <div class="panel-header">
                        <h2>ç•™è¨€ç®¡ç†</h2>
                        <div class="panel-tools">
                            <input type="text" id="searchMessage" placeholder="æœç´¢ç•™è¨€..." class="search-input">
                            <select id="messageFilter" class="filter-select">
                                <option value="all">å…¨éƒ¨ç•™è¨€</option>
                                <option value="today">ä»Šå¤©</option>
                                <option value="week">æœ¬å‘¨</option>
                                <option value="month">æœ¬æœˆ</option>
                            </select>
                        </div>
                    </div>
                    <div class="message-list" id="messageList"></div>
                </div>

                <!-- è´¦å·ç®¡ç†é¢æ¿ -->
                <div id="accountPanel" class="panel">
                    <div class="panel-header">
                        <h2>è´¦å·ç®¡ç†</h2>
                        <button class="add-btn" onclick="showAddAccountForm()">æ·»åŠ è´¦å·</button>
                    </div>
                    <div class="account-list" id="accountList"></div>
                    <!-- æ·»åŠ è´¦å·è¡¨å• -->
                    <div id="addAccountForm" class="modal" style="display: none;">
                        <div class="modal-content">
                            <h3>æ·»åŠ ç®¡ç†å‘˜è´¦å·</h3>
                            <form id="newAccountForm">
                                <div class="form-group">
                                    <label for="newUsername">ç”¨æˆ·å</label>
                                    <input type="text" id="newUsername" required>
                                </div>
                                <div class="form-group">
                                    <label for="newPassword">å¯†ç </label>
                                    <input type="password" id="newPassword" required>
                                </div>
                                <div class="form-group">
                                    <label for="newRole">è§’è‰²</label>
                                    <select id="newRole" required>
                                        <option value="admin">ç®¡ç†å‘˜</option>
                                        <option value="editor">ç¼–è¾‘</option>
                                    </select>
                                </div>
                                <div class="form-buttons">
                                    <button type="submit" class="submit-btn">æ·»åŠ </button>
                                    <button type="button" class="cancel-btn" onclick="hideAddAccountForm()">å–æ¶ˆ</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- ç³»ç»Ÿè®¾ç½®é¢æ¿ -->
                <div id="systemPanel" class="panel">
                    <div class="panel-header">
                        <h2>ç³»ç»Ÿè®¾ç½®</h2>
                    </div>
                    <div class="settings-form">
                        <div class="form-group">
                            <label>ç•™è¨€å®¡æ ¸</label>
                            <div class="switch-field">
                                <input type="radio" id="audit-on" name="audit" value="on">
                                <label for="audit-on">å¼€å¯</label>
                                <input type="radio" id="audit-off" name="audit" value="off" checked>
                                <label for="audit-off">å…³é—­</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>ç•™è¨€é—´éš”ï¼ˆç§’ï¼‰</label>
                            <input type="number" id="messageInterval" value="60" min="0">
                        </div>
                        <div class="form-group">
                            <label>æ¯é¡µæ˜¾ç¤ºæ•°é‡</label>
                            <input type="number" id="pageSize" value="10" min="5" max="50">
                        </div>
                        <button class="submit-btn" onclick="saveSettings()">ä¿å­˜è®¾ç½®</button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        // åˆå§‹åŒ– Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCO10m4FAA06N1uo9OF7lLZfC4v87_5YZM",
            authDomain: "yhaa-fa919.firebaseapp.com",
            projectId: "yhaa-fa919",
            storageBucket: "yhaa-fa919.firebasestorage.app",
            messagingSenderId: "149486643204",
            appId: "1:149486643204:web:f49998b462bbc5c2d52d51",
            measurementId: "G-QLCZSRWK1J"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // ç®¡ç†å‘˜è´¦å·ä¿¡æ¯
        const ADMIN_CREDENTIALS = {
            "admin": {
                password: "ac0e7d037817094e9e0b4441f9bae3209d67b02fa484917065f71b16109a1a78",
                originalPassword: "admin123456",
                role: "ä¸»ç³»ç»Ÿ"
            },
            "manager": {
                password: "240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9",
                originalPassword: "admin123",
                role: "admin"
            },
            "editor": {
                password: "8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92",
                originalPassword: "123456",
                role: "editor"
            }
        };

        // åˆ‡æ¢é¢æ¿
        function switchPanel(panelName) {
            // ç§»é™¤æ‰€æœ‰é¢æ¿çš„activeç±»
            document.querySelectorAll('.panel').forEach(panel => {
                panel.classList.remove('active');
            });
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // æ¿€æ´»é€‰ä¸­çš„é¢æ¿
            document.getElementById(panelName + 'Panel').classList.add('active');
            event.target.classList.add('active');
        }

        // æ˜¾ç¤ºæ·»åŠ è´¦å·è¡¨å•
        function showAddAccountForm() {
            document.getElementById('addAccountForm').style.display = 'flex';
        }

        // éšè—æ·»åŠ è´¦å·è¡¨å•
        function hideAddAccountForm() {
            document.getElementById('addAccountForm').style.display = 'none';
        }

        // ä¿å­˜ç³»ç»Ÿè®¾ç½®
        function saveSettings() {
            const settings = {
                audit: document.querySelector('input[name="audit"]:checked').value,
                messageInterval: document.getElementById('messageInterval').value,
                pageSize: document.getElementById('pageSize').value
            };
            
            localStorage.setItem('systemSettings', JSON.stringify(settings));
            showToast('è®¾ç½®å·²ä¿å­˜');
        }

        // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }

        // ç™»å½•è¡¨å•å¤„ç†
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            
            const passwordHash = CryptoJS.SHA256(password).toString();
            const userInfo = ADMIN_CREDENTIALS[username];

            if (userInfo && userInfo.password === passwordHash) {
                console.log('ç™»å½•æˆåŠŸï¼è§’è‰²:', userInfo.role);
                localStorage.setItem('isAdmin', 'true');
                localStorage.setItem('adminUsername', username);
                localStorage.setItem('adminRole', userInfo.role);
                localStorage.setItem('adminLoginTime', Date.now());
                
                document.querySelector('.admin-login').style.display = 'none';
                document.querySelector('.admin-panel').style.display = 'grid';
                
                // è®¾ç½®ç®¡ç†å‘˜ä¿¡æ¯
                document.getElementById('adminInfo').textContent = 
                    `${username} (${userInfo.role})`;
                
                // æ ¹æ®è§’è‰²æ˜¾ç¤º/éšè—åŠŸèƒ½
                if (userInfo.role === 'editor') {
                    document.querySelectorAll('.nav-btn').forEach(btn => {
                        if (btn.textContent !== 'ç•™è¨€ç®¡ç†') {
                            btn.classList.add('locked');
                            btn.disabled = true;
                        }
                    });
                } else if (userInfo.role === 'admin') {
                    document.querySelectorAll('.nav-btn').forEach(btn => {
                        if (btn.textContent === 'è´¦å·ç®¡ç†') {
                            btn.classList.add('locked');
                            btn.disabled = true;
                        }
                    });
                }
                
                applyLockEffects();
                loadMessages();
            } else {
                const errorDiv = document.getElementById('loginError');
                errorDiv.textContent = 'è´¦å·æˆ–å¯†ç é”™è¯¯ï¼';
                errorDiv.style.display = 'block';
                setTimeout(() => {
                    errorDiv.style.display = 'none';
                }, 3000);
            }
        });

        // é€€å‡ºç™»å½•
        function logout() {
            localStorage.removeItem('isAdmin');
            localStorage.removeItem('adminUsername');
            localStorage.removeItem('adminRole');
            localStorage.removeItem('adminLoginTime');
            document.querySelector('.admin-login').style.display = 'block';
            document.querySelector('.admin-panel').style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        // æ£€æŸ¥ç™»å½•çŠ¶æ€å’Œä¼šè¯æ—¶é—´
        function checkLoginStatus() {
            const isAdmin = localStorage.getItem('isAdmin') === 'true';
            const loginTime = parseInt(localStorage.getItem('adminLoginTime') || '0');
            const currentTime = Date.now();
            const sessionTimeout = 30 * 60 * 1000;

            if (isAdmin && (currentTime - loginTime) < sessionTimeout) {
                const username = localStorage.getItem('adminUsername');
                const role = localStorage.getItem('adminRole');
                
                document.querySelector('.admin-login').style.display = 'none';
                document.querySelector('.admin-panel').style.display = 'grid';
                document.getElementById('adminInfo').textContent = 
                    `${username} (${role})`;
                
                if (role === 'editor') {
                    document.querySelectorAll('.nav-btn').forEach(btn => {
                        if (btn.textContent !== 'ç•™è¨€ç®¡ç†') {
                            btn.classList.add('locked');
                            btn.disabled = true;
                        }
                    });
                } else if (role === 'admin') {
                    document.querySelectorAll('.nav-btn').forEach(btn => {
                        if (btn.textContent === 'è´¦å·ç®¡ç†') {
                            btn.classList.add('locked');
                            btn.disabled = true;
                        }
                    });
                }
                
                applyLockEffects();
                loadMessages();
            } else {
                logout();
            }
        }

        // åŠ è½½æ‰€æœ‰ç•™è¨€
        async function loadMessages() {
            try {
                const querySnapshot = await db.collection('messages')
                    .orderBy('createdAt', 'desc')
                    .get();
                
                const messageList = document.getElementById('messageList');
                messageList.innerHTML = '';
                
                const canDelete = hasDeletePermission();
                
                querySnapshot.forEach(doc => {
                    const data = doc.data();
                    const messageElement = document.createElement('div');
                    messageElement.className = 'message-item';
                    
                    const timestamp = data.createdAt ? data.createdAt.toDate().toLocaleString() : 'æ—¶é—´æœªçŸ¥';
                    
                    messageElement.innerHTML = `
                        <div class="message-header">
                            <strong>${data.name}</strong>
                            <span>${timestamp}</span>
                            ${canDelete ? `
                                <div class="message-actions">
                                    <button class="delete-btn" onclick="deleteMessage('${doc.id}')">åˆ é™¤</button>
                                    <button class="block-btn" onclick="blockUser('${data.name}')">å±è”½ç”¨æˆ·</button>
                                </div>
                            ` : ''}
                        </div>
                        <div class="message-content">${data.content}</div>
                    `;
                    messageList.appendChild(messageElement);
                });
            } catch (error) {
                console.error('åŠ è½½å¤±è´¥:', error);
                showToast('åŠ è½½ç•™è¨€å¤±è´¥ï¼š' + error.message);
            }
        }

        // åˆ é™¤ç•™è¨€
        async function deleteMessage(messageId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡ç•™è¨€å—ï¼Ÿ')) {
                try {
                    await db.collection('messages').doc(messageId).delete();
                    showToast('åˆ é™¤æˆåŠŸ');
                    loadMessages();
                } catch (error) {
                    console.error('åˆ é™¤å¤±è´¥:', error);
                    showToast('åˆ é™¤å¤±è´¥ï¼š' + error.message);
                }
            }
        }

        // å±è”½ç”¨æˆ·
        function blockUser(username) {
            if (confirm(`ç¡®å®šè¦å±è”½ç”¨æˆ· "${username}" å—ï¼Ÿ`)) {
                const blockedUsers = JSON.parse(localStorage.getItem('blockedUsers') || '[]');
                if (!blockedUsers.includes(username)) {
                    blockedUsers.push(username);
                    localStorage.setItem('blockedUsers', JSON.stringify(blockedUsers));
                    showToast(`å·²å±è”½ç”¨æˆ· "${username}"`);
                }
            }
        }

        // æ£€æŸ¥åˆ é™¤æƒé™
        function hasDeletePermission() {
            const role = localStorage.getItem('adminRole');
            return role === 'ä¸»ç³»ç»Ÿ' || role === 'admin';
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€
        checkLoginStatus();

        // æœç´¢ç•™è¨€
        document.getElementById('searchMessage').addEventListener('input', function(e) {
            const searchText = e.target.value.toLowerCase();
            const messages = document.querySelectorAll('.message-item');
            
            messages.forEach(message => {
                const content = message.querySelector('.message-content').textContent.toLowerCase();
                const name = message.querySelector('strong').textContent.toLowerCase();
                
                if (content.includes(searchText) || name.includes(searchText)) {
                    message.style.display = 'block';
                } else {
                    message.style.display = 'none';
                }
            });
        });

        // ç•™è¨€è¿‡æ»¤
        document.getElementById('messageFilter').addEventListener('change', function(e) {
            const filter = e.target.value;
            const now = new Date();
            const messages = document.querySelectorAll('.message-item');
            
            messages.forEach(message => {
                const timestamp = message.querySelector('span').textContent;
                const messageDate = new Date(timestamp);
                
                let show = true;
                if (filter === 'today') {
                    show = messageDate.toDateString() === now.toDateString();
                } else if (filter === 'week') {
                    const weekAgo = new Date(now - 7 * 24 * 60 * 60 * 1000);
                    show = messageDate >= weekAgo;
                } else if (filter === 'month') {
                    show = messageDate.getMonth() === now.getMonth() &&
                           messageDate.getFullYear() === now.getFullYear();
                }
                
                message.style.display = show ? 'block' : 'none';
            });
        });

        // æ·»åŠ æ–°ç®¡ç†å‘˜è´¦å·
        document.getElementById('newAccountForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('newUsername').value.trim();
            const password = document.getElementById('newPassword').value;
            const role = document.getElementById('newRole').value;
            
            if (ADMIN_CREDENTIALS[username]) {
                showToast('ç”¨æˆ·åå·²å­˜åœ¨');
                return;
            }
            
            const passwordHash = CryptoJS.SHA256(password).toString();
            ADMIN_CREDENTIALS[username] = {
                password: passwordHash,
                role: role
            };
            
            showToast('æ·»åŠ è´¦å·æˆåŠŸ');
            hideAddAccountForm();
            loadAccounts();
        });

        // åŠ è½½è´¦å·åˆ—è¡¨
        function loadAccounts() {
            const accountList = document.getElementById('accountList');
            accountList.innerHTML = '';
            
            Object.entries(ADMIN_CREDENTIALS).forEach(([username, info]) => {
                const accountElement = document.createElement('div');
                accountElement.className = 'account-item';
                accountElement.innerHTML = `
                    <div class="account-info">
                        <strong>${username}</strong>
                        <span>${info.role}</span>
                    </div>
                    ${info.role !== 'ä¸»ç³»ç»Ÿ' ? `
                        <div class="account-actions">
                            <button class="edit-btn" onclick="editAccount('${username}')">ç¼–è¾‘</button>
                            <button class="delete-btn" onclick="deleteAccount('${username}')">åˆ é™¤</button>
                        </div>
                    ` : ''}
                `;
                accountList.appendChild(accountElement);
            });
        }

        // æ˜¾ç¤ºå¸®åŠ©è¯´æ˜
        function showHelp() {
            const modal = document.getElementById('helpModal');
            modal.style.display = 'flex';
            // æ·»åŠ ç‚¹å‡»å¤–éƒ¨å…³é—­
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    hideHelp();
                }
            });
        }

        // éšè—å¸®åŠ©è¯´æ˜
        function hideHelp() {
            document.getElementById('helpModal').style.display = 'none';
        }

        // æ·»åŠ å¯†é’¥ç»„åˆç›‘å¬
        let ctrlPressed = false;
        let altPressed = false;

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Control') ctrlPressed = true;
            if (e.key === 'Alt') altPressed = true;
            if (ctrlPressed && altPressed && e.key === 's') {
                e.preventDefault();
                const role = localStorage.getItem('adminRole');
                if (role === 'ä¸»ç³»ç»Ÿ') {
                    showSecretPanel();
                }
            }
        });

        document.addEventListener('keyup', function(e) {
            if (e.key === 'Control') ctrlPressed = false;
            if (e.key === 'Alt') altPressed = false;
        });

        // æ˜¾ç¤ºç§˜å¯†é¢æ¿
        function showSecretPanel() {
            const modal = document.getElementById('secretModal');
            const content = document.getElementById('secretContent');
            content.innerHTML = '';
            
            // æ˜¾ç¤ºæ‰€æœ‰è´¦å·ä¿¡æ¯
            const decryptedInfo = Object.entries(ADMIN_CREDENTIALS).map(([username, info]) => {
                return `
                    <div class="secret-item">
                        <h4>${username}</h4>
                        <p>è§’è‰²ï¼š${info.role}</p>
                        <p class="password-info">
                            <span class="label">åŸå§‹å¯†ç ï¼š</span>
                            <span class="value">${info.originalPassword}</span>
                            <button class="copy-btn" onclick="copyToClipboard('${info.originalPassword}')">å¤åˆ¶</button>
                        </p>
                        <p class="hash-info">
                            <span class="label">å¯†ç å“ˆå¸Œï¼š</span>
                            <span class="value">${info.password}</span>
                            <button class="copy-btn" onclick="copyToClipboard('${info.password}')">å¤åˆ¶</button>
                        </p>
                    </div>
                `;
            }).join('');
            
            content.innerHTML = decryptedInfo;
            modal.style.display = 'flex';
        }

        // éšè—ç§˜å¯†é¢æ¿
        function hideSecretPanel() {
            document.getElementById('secretModal').style.display = 'none';
        }

        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                showToast('å¤åˆ¶å¤±è´¥');
            });
        }

        // åœ¨ç™»å½•æˆåŠŸåæ·»åŠ é”å®šæ•ˆæœ
        function applyLockEffects() {
            const role = localStorage.getItem('adminRole');
            const buttons = document.querySelectorAll('.nav-btn');
            
            // å…ˆç§»é™¤æ‰€æœ‰ç°æœ‰çš„é”å®šæ•ˆæœ
            buttons.forEach(btn => {
                const wrapper = btn.closest('.locked-wrapper');
                if (wrapper) {
                    wrapper.parentNode.insertBefore(btn, wrapper);
                    wrapper.remove();
                }
            });
            
            // åªå¯¹éœ€è¦é”å®šçš„æŒ‰é’®æ·»åŠ æ•ˆæœ
            buttons.forEach(btn => {
                if ((role === 'editor' && btn.textContent !== 'ç•™è¨€ç®¡ç†') ||
                    (role === 'admin' && btn.textContent === 'è´¦å·ç®¡ç†')) {
                    
                    // åˆ›å»ºåŒ…è£…å™¨å…ƒç´ 
                    const wrapper = document.createElement('div');
                    wrapper.className = 'locked-wrapper';
                    btn.parentNode.insertBefore(wrapper, btn);
                    wrapper.appendChild(btn);
                    
                    // åˆ›å»ºæç¤ºå…ƒç´ 
                    const tooltip = document.createElement('div');
                    tooltip.className = 'locked-tooltip';
                    tooltip.textContent = 'æ— æƒé™è®¿é—®æ­¤åŠŸèƒ½';
                    wrapper.appendChild(tooltip);
                    
                    btn.classList.add('locked');
                    btn.disabled = true;
                }
            });
        }

        // æ·»åŠ å¯¼èˆªæ æ”¶èµ·/å±•å¼€åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', function() {
            const toggleNav = document.getElementById('toggleNav');
            const sidebar = document.querySelector('.admin-sidebar');
            
            if (toggleNav && sidebar) {
                toggleNav.addEventListener('click', function() {
                    sidebar.classList.toggle('collapsed');
                    toggleNav.classList.toggle('collapsed');
                    
                    // ä¿å­˜çŠ¶æ€åˆ°æœ¬åœ°å­˜å‚¨
                    localStorage.setItem('navCollapsed', sidebar.classList.contains('collapsed'));
                });
                
                // æ¢å¤ä¸Šæ¬¡çš„çŠ¶æ€
                const isCollapsed = localStorage.getItem('navCollapsed') === 'true';
                if (isCollapsed) {
                    sidebar.classList.add('collapsed');
                    toggleNav.classList.add('collapsed');
                }
            }
        });
    </script>

    <style>
        /* åŸºç¡€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            background: #f5f5f5;
        }

        /* ç™»å½•é¡µé¢æ ·å¼ */
        .admin-login {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-form {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
        }

        .login-form h2 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }

        .submit-btn {
            width: 100%;
            padding: 12px;
            background: #4f46e5;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .submit-btn:hover {
            background: #4338ca;
        }

        /* ç®¡ç†é¢æ¿æ ·å¼ */
        .admin-panel {
            display: grid;
            grid-template-columns: 1fr;
            min-height: 100vh;
            background: #f9fafb;
        }

        .admin-sidebar {
            background: white;
            padding: 20px;
            border-bottom: 1px solid #e5e7eb;
        }

        .admin-nav {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }

        .nav-btn {
            padding: 12px;
            border: none;
            background: #f3f4f6;
            border-radius: 6px;
            color: #4b5563;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            position: relative;
            z-index: 15;
        }

        .nav-btn:hover {
            background: #e5e7eb;
            color: #4b5563;
        }

        .nav-btn.active {
            background: #4f46e5;
            color: white;
        }

        .nav-btn:not(.locked):hover {
            background: #4338ca;
            color: white;
        }

        .logout-btn {
            margin-top: 20px;
            padding: 12px;
            border: none;
            background: #ef4444;
            color: white;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }

        .logout-btn:hover {
            background: #dc2626;
        }

        .admin-content {
            padding: 20px;
        }

        .panel-header {
            margin-bottom: 20px;
        }

        .panel-tools {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }

        .search-input, .filter-select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }

        /* æ¶ˆæ¯åˆ—è¡¨æ ·å¼ */
        .message-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .message-header {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 10px;
        }

        .message-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .delete-btn, .block-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .delete-btn {
            background: #ef4444;
            color: white;
        }

        .block-btn {
            background: #6b7280;
            color: white;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (min-width: 768px) {
            .admin-panel {
                grid-template-columns: 250px 1fr;
            }

            .admin-sidebar {
                border-right: 1px solid #e5e7eb;
                border-bottom: none;
                height: 100vh;
            }

            .panel-tools {
                flex-direction: row;
            }

            .search-input {
                flex: 1;
            }
        }

        /* é”™è¯¯æ¶ˆæ¯æ ·å¼ */
        .error-message {
            background: #fee2e2;
            color: #dc2626;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 20px;
            text-align: center;
        }

        /* Toastæ¶ˆæ¯æ ·å¼ */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .toast.show {
            opacity: 1;
        }

        @keyframes shake {
            0% { 
                transform: translateX(0) rotate(0); 
            }
            10% { 
                transform: translateX(calc(var(--shake-intensity) * -1)) rotate(calc(var(--shake-intensity) * -0.5deg));
            }
            20% { 
                transform: translateX(var(--shake-intensity)) rotate(calc(var(--shake-intensity) * 0.5deg));
            }
            30% { 
                transform: translateX(calc(var(--shake-intensity) * -1.2)) rotate(calc(var(--shake-intensity) * -0.7deg));
            }
            40% { 
                transform: translateX(calc(var(--shake-intensity) * 1.2)) rotate(calc(var(--shake-intensity) * 0.7deg));
            }
            50% { 
                transform: translateX(calc(var(--shake-intensity) * -1.5)) rotate(calc(var(--shake-intensity) * -0.9deg));
            }
            60% { 
                transform: translateX(calc(var(--shake-intensity) * 1.5)) rotate(calc(var(--shake-intensity) * 0.9deg));
            }
            70% { 
                transform: translateX(calc(var(--shake-intensity) * -1.8)) rotate(calc(var(--shake-intensity) * -1.1deg));
            }
            80% { 
                transform: translateX(calc(var(--shake-intensity) * 1.8)) rotate(calc(var(--shake-intensity) * 1.1deg));
            }
            90% { 
                transform: translateX(calc(var(--shake-intensity) * -2)) rotate(calc(var(--shake-intensity) * -1.3deg));
            }
            100% { 
                transform: translateX(calc(var(--shake-intensity) * 2)) rotate(calc(var(--shake-intensity) * 1.3deg));
            }
        }

        @keyframes explode {
            0% { 
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.5);
                opacity: 0.8;
            }
            100% {
                transform: scale(2);
                opacity: 0;
            }
        }

        @keyframes particle-fall {
            0% {
                transform: translateY(0) translateX(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(1000px) translateX(var(--particle-x)) rotate(var(--particle-rotate));
                opacity: 0;
            }
        }

        .locked {
            position: relative;
            opacity: 0.7;
            cursor: not-allowed;
            background-color: #f3f4f6;
            border: 1px solid #d1d5db;
            pointer-events: none;
            color: #4b5563;
        }

        .locked::before {
            content: 'ğŸ”’';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            z-index: 10;
            filter: grayscale(100%) brightness(0.8);
        }

        .locked::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                45deg,
                rgba(128, 128, 128, 0.3),
                rgba(128, 128, 128, 0.3) 10px,
                rgba(169, 169, 169, 0.4) 10px,
                rgba(169, 169, 169, 0.4) 20px
            );
            border-radius: inherit;
            z-index: 5;
            border: 2px solid rgba(128, 128, 128, 0.5);
        }

        .locked-wrapper {
            position: relative;
            display: inline-block;
        }

        .locked-tooltip {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            margin-top: 5px;
            z-index: 100;
        }

        .locked-wrapper:hover .locked-tooltip,
        .locked-wrapper:active .locked-tooltip {
            opacity: 1;
        }

        .shaking {
            animation: shake 0.15s infinite;
            animation-timing-function: linear;
        }

        .exploding {
            animation: explode 0.5s ease-out forwards;
        }

        .particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #808080;
            border-radius: 50%;
            animation: particle-fall 5s ease-in forwards;
        }

        /* æ·»åŠ åˆ°ç°æœ‰çš„styleæ ‡ç­¾ä¸­æˆ–admin.cssæ–‡ä»¶ä¸­ */
        .secret-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .secret-item {
            background: rgba(99, 102, 241, 0.1);
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-radius: 12px;
            border: 1px solid rgba(99, 102, 241, 0.2);
        }

        .secret-item h4 {
            color: #6366f1;
            margin: 0 0 1rem 0;
            font-size: 1.2rem;
        }

        .password-info, .hash-info {
            display: flex;
            align-items: center;
            margin: 0.5rem 0;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 6px;
        }

        .label {
            color: #4b5563;
            font-weight: 500;
            min-width: 100px;
        }

        .value {
            font-family: monospace;
            color: #1f2937;
            padding: 0.25rem 0.5rem;
            background: rgba(99, 102, 241, 0.1);
            border-radius: 4px;
            margin: 0 0.5rem;
            flex: 1;
        }

        .copy-btn {
            background: #6366f1;
            color: white;
            border: none;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s ease;
        }

        .copy-btn:hover {
            background: #4f46e5;
        }

        .secret-modal .help-content {
            max-width: 800px;
            background: white;
            padding: 2rem;
        }

        .admin-info {
            padding: 10px;
            background: #f3f4f6;
            border-radius: 6px;
            color: #1f2937;
            font-weight: 500;
            text-align: center;
            margin-bottom: 10px;
            font-size: 16px;
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media screen and (max-width: 767px) {
            body {
                font-size: 14px;
            }

            /* ç™»å½•é¡µé¢ç§»åŠ¨ç«¯ä¼˜åŒ– */
            .login-form {
                width: 90%;
                margin: 10px;
                padding: 15px;
            }

            .login-form h2 {
                font-size: 20px;
            }

            .form-group input {
                height: 40px;
                font-size: 16px;
            }

            /* ç®¡ç†é¢æ¿ç§»åŠ¨ç«¯ä¼˜åŒ– */
            .admin-panel {
                display: flex;
                flex-direction: column;
                height: 100vh;
            }

            .admin-sidebar {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                z-index: 1000;
                background: white;
                padding: 8px;
                box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
                height: auto;
            }

            .admin-info {
                display: none;
            }

            .admin-nav {
                display: flex;
                flex-direction: row;
                justify-content: space-between;
                gap: 5px;
                margin: 0;
            }

            .nav-btn, .logout-btn {
                flex: 1;
                padding: 10px 5px;
                font-size: 12px;
                height: 40px;
                display: flex;
                align-items: center;
                justify-content: center;
                white-space: nowrap;
                margin: 0;
            }

            .admin-content {
                flex: 1;
                padding: 10px;
                margin-bottom: 60px;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }

            .panel-header h2 {
                font-size: 18px;
                margin-bottom: 10px;
            }

            .panel-tools {
                gap: 8px;
            }

            .search-input, .filter-select {
                height: 40px;
                font-size: 14px;
            }

            .message-item {
                padding: 12px;
                margin-bottom: 10px;
            }

            .message-header {
                flex-direction: column;
                gap: 5px;
            }

            .message-actions {
                display: flex;
                gap: 8px;
                margin-top: 8px;
            }

            .delete-btn, .block-btn {
                flex: 1;
                height: 36px;
                font-size: 14px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            /* å¼¹çª—ä¼˜åŒ– */
            .help-modal .help-content,
            .secret-modal .help-content {
                width: 90%;
                max-height: 80vh;
                overflow-y: auto;
                padding: 15px;
                margin: 20px;
                border-radius: 8px;
            }

            /* Toastæ¶ˆæ¯ä¼˜åŒ– */
            .toast {
                width: 90%;
                bottom: 70px;
                font-size: 14px;
                padding: 12px;
            }

            /* é”å®šæŒ‰é’®ä¼˜åŒ– */
            .locked::before {
                font-size: 14px;
            }

            .locked-wrapper {
                width: 100%;
            }
        }

        /* ç§»åŠ¨ç«¯å¯¼èˆªæ æ”¶èµ·æŒ‰é’® */
        .toggle-nav {
            display: none;
            width: 100%;
            padding: 8px;
            background: #f3f4f6;
            border: none;
            border-radius: 6px;
            color: #4b5563;
            cursor: pointer;
            margin-bottom: 8px;
        }

        .toggle-icon {
            display: inline-block;
            transition: transform 0.3s;
        }

        .toggle-nav.collapsed .toggle-icon {
            transform: rotate(180deg);
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media screen and (max-width: 767px) {
            .toggle-nav {
                display: block;
            }

            .admin-sidebar {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                z-index: 1000;
                background: white;
                padding: 8px;
                box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
                height: auto;
                transition: transform 0.3s ease-in-out;
            }

            .admin-sidebar.collapsed {
                transform: translateY(calc(100% - 40px));
            }

            .admin-sidebar.collapsed .admin-nav {
                opacity: 0;
                pointer-events: none;
            }

            .admin-nav {
                opacity: 1;
                transition: opacity 0.3s;
            }

            .admin-content {
                margin-bottom: 100px;
            }
        }
    </style>
</body>
</html> 